"use strict";function preload(){(backgroundSound=loadSound("dist/sounds/main_theme.mp3")).setVolume(.7),(gameOverSound=loadSound("dist/sounds/game_over.mp3")).setVolume(.4),(laserSound=loadSound("dist/sounds/pew.mp3")).setVolume(.2);for(var s=0;s<3;s++)explosionSoundEffects[s]=loadSound("dist/sounds/explosion_"+s+".mp3"),explosionSoundEffects[s].setVolume(.6)}function setupReload(){ship.position=createVector(width/2,height/2),ship.head=0,ship.rotation=0,ship.speed=createVector(0,0),ship.isBoosting=!1;for(var s=0;s<difficulty;s++)asteroids.push(new Asteroid)}function setup(){createCanvas(windowWidth,windowHeight),backgroundImage=loadImage("dist/images/space.jpg"),backgroundSound.loop(),ship=new Ship,hud=new Hud,sticks=new Sticks,setupReload()}function draw(){background(backgroundImage),0==asteroids.length&&(difficulty+=1,levelNumber+=1,hud.update(),setupReload());for(s=0;s<asteroids.length;s++)ship.hits(asteroids[s])&&(healthPoints-=1,hud.update()),asteroids[s].render(),asteroids[s].update(),asteroids[s].edges();healthPoints<=0&&(backgroundSound.stop(),gameOverSound.play(),asteroids=[],difficulty=5,healthPoints=100,levelNumber=1,scorePoints=0,setupReload(),backgroundSound.play());for(var s=lasers.length-1;s>=0;s--)if(lasers[s].render(),lasers[s].update(),lasers[s].offscreen())lasers.splice(s,1);else for(var i=asteroids.length-1;i>=0;i--)if(lasers[s].hits(asteroids[i])){if(asteroids[i].playSoundEffect(explosionSoundEffects),scorePoints+=100,hud.update(),asteroids[i].size>15){var t=asteroids[i].breakup();asteroids=asteroids.concat(t)}asteroids.splice(i,1),lasers.splice(s,1);break}scorePointsHigh<scorePoints&&(scorePointsHigh=scorePoints,hud.update()),ship.render(),ship.turn(),ship.update(),ship.edges(),hud.render(),sticks.render()}function keyPressed(){input.handleEvent(key,keyCode,!0),77==keyCode?backgroundSound.isPlaying()?backgroundSound.pause():backgroundSound.play():82==keyCode&&(asteroids=[],difficulty=5,healthPoints=100,levelNumber=1,scorePoints=0,setupReload())}function keyReleased(){input.handleEvent(key,keyCode,!1)}function mousePressed(){sticks.pressed()}function mouseReleased(){sticks.released()}function Ship(){this.position=createVector(width/2,height/2),this.size=20,this.head=0,this.rotation=0,this.speed=createVector(0,0),this.isBoosting=!1;var s=this;input.registerAsListener(32,function(s,i,t){t&&(lasers.push(new Laser(ship.position,ship.head)),laserSound.play())}),input.registerAsListener(RIGHT_ARROW,function(i,t,e){s.setRotation(e?.1:0)}),input.registerAsListener(LEFT_ARROW,function(i,t,e){s.setRotation(e?-.1:0)}),input.registerAsListener(UP_ARROW,function(i,t,e){s.boosting(!!e)}),this.boosting=function(s){this.isBoosting=s},this.update=function(){this.isBoosting&&this.boost(),this.position.add(this.speed),this.speed.mult(.99)},this.boost=function(){var s=p5.Vector.fromAngle(this.head);s.mult(.1),this.speed.add(s)},this.render=function(){push(),translate(this.position.x,this.position.y),rotate(this.head+PI/2),fill(10),stroke(255),triangle(10-this.size,this.size,this.size-10,this.size,0,-this.size),translate(0,18),fill(210,85,90),noStroke(),triangle(0,2,8,8,-8,8),pop()},this.edges=function(){this.position.x>width+this.size?this.position.x=-this.size:this.position.x<-this.size&&(this.position.x=width+this.size),this.position.y>height+this.size?this.position.y=-this.size:this.position.y<-this.size&&(this.position.y=height+this.size)},this.setRotation=function(s){this.rotation=s},this.turn=function(){this.head+=this.rotation},this.hits=function(s){return dist(this.position.x,this.position.y,s.position.x,s.position.y)<this.size+s.size}}function Asteroid(s,i){this.position=s?s.copy():createVector(random(width),random(height)),this.size=i?.5*i:random(15,50),this.speed=p5.Vector.random2D(),this.sides=floor(random(5,15)),this.offset=[];for(var t=0;t<this.sides;t++)this.offset[t]=random(.2*-this.size,.2*this.size);this.render=function(){push(),translate(this.position.x,this.position.y),fill(10),stroke(255),beginShape();for(var s=0;s<this.sides;s++){var i=map(s,0,this.sides,0,TWO_PI),t=(this.size+this.offset[s])*cos(i),e=(this.size+this.offset[s])*sin(i);vertex(t,e)}endShape(CLOSE),pop()},this.update=function(){this.position.add(this.speed)},this.edges=function(){this.position.x>width+this.size?this.position.x=-this.size:this.position.x<-this.size&&(this.position.x=width+this.size),this.position.y>height+this.size?this.position.y=-this.size:this.position.y<-this.size&&(this.position.y=height+this.size)},this.breakup=function(){var s=[];return s[0]=new Asteroid(this.position,this.size),s[1]=new Asteroid(this.position,this.size),s},this.playSoundEffect=function(s){s[floor(random(0,s.length))].play()}}function Laser(s,i){this.position=createVector(s.x,s.y),this.speed=p5.Vector.fromAngle(i),this.speed.mult(8),this.color=colors[floor(random(0,colors.length-1))],this.update=function(){this.position.add(this.speed)},this.render=function(){push(),stroke(this.color[0],this.color[1],this.color[2]),strokeWeight(5),point(this.position.x,this.position.y),pop()},this.hits=function(s){return dist(this.position.x,this.position.y,s.position.x,s.position.y)<s.size},this.offscreen=function(){return this.position.x>width||this.position.x<0||(this.position.y>height||this.position.y<0)}}function Hud(){this.render=function(){textSize(32),fill(255),text(scorePoints,0,62),text("Level "+levelNumber,0,36),textSize(13),fill(255),text("High score "+scorePointsHigh,0,80),push(),fill(210,85,90),noStroke(),rect(0,0,width*(healthPoints/100),10),pop()},this.update=function(){textSize(32),fill(255),text(scorePoints,0,62),text("Level "+levelNumber,0,36),push(),rect(0,0,width*(healthPoints/100),0),pop()}}function Sticks(){this.render=function(){push(),noFill(),colorMode(RGB,255,255,255,1),strokeWeight(3),stroke(210,85,90,.2),ellipse(80,height-80,100,100),pop(),push(),noFill(),colorMode(RGB,255,255,255,1),strokeWeight(3),stroke(210,85,90,.2),ellipse(width-80,height-80,100,100),pop()},this.pressed=function(){var s=dist(mouseX,mouseY,80,height-80),i=dist(mouseX,mouseY,width-80,height-80);if(s<50)ship.setRotation(-.1);else{if(!(i<50))return lasers.push(new Laser(ship.position,ship.head)),laserSound.play(),!1;ship.setRotation(.1)}},this.released=function(){ship.setRotation(0)}}var backgroundImage,backgroundSound,gameOverSound,laserSound,ship,sticks,hud,explosionSoundEffects=[],asteroids=[],lasers=[],difficulty=5,scorePoints=0,scorePointsHigh=0,healthPoints=100,levelNumber=1,colors=[[248,12,18],[238,17,0],[255,51,17],[255,68,34],[255,102,68],[255,153,51],[254,174,45],[204,187,51],[208,195,16],[170,204,34],[105,208,37],[34,204,170],[18,189,185],[17,170,187],[68,68,221],[51,17,187],[59,12,189],[68,34,153]],input={listeners:{},reset:function(){this.listeners={}},registerAsListener:function(s,i){void 0==this.listeners[s]&&(this.listeners[s]=[]),this.listeners[s].push(i)},handleEvent:function(s,i,t){if(void 0!=this.listeners[i])for(var e=0;e<this.listeners[i].length;e++)this.listeners[i][e](s,i,t)}};